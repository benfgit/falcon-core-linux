processors:
    source:
        class: NlxReader
        advanced:
            threadpriority: 100
            threadcore: 0
        options:
            address: 127.0.0.1
            port: 5000
            batch size: 3
            update interval: 10
            channelmap:
                hp: [13,20]
                cx: [9]
    ripple_filter (1-2):
        class: MultiChannelFilter
        options:
            filter:
                file: iir_ripple_low_delay/matlab_design/iir_ripple_low_delay.filter
    HIPPOCAMPUS_detector:
        class: RippleDetector
        options:
            threshold dev: 14
            smooth time: 7 # in seconds
            analysis lockout time: 50 #ms
            stream events: true
            stream statistics: true
            statistics buffer size: 1.0 # sec
            statistics downsample factor: 4
            use power: true
    CORTEX_detector:
        class: RippleDetector
        options:
            threshold dev: 12
            smooth time: 8 # in seconds
            analysis lockout time: 40 #ms
            stream events: true
            stream statistics: false
            statistics buffer size: 1.0 # sec
            statistics downsample factor: 4
            use power: true
    eventfilter:
        class: EventFilter
        options:
            target event: ripple
            block duration: 40
            sync time: 1.5
            block wait time: 4 # below 3.5, asynch can occur
            detection criterion: "any" # 'any', 'all' or number
            discard warnings: false
    networksink:
        class: ZMQSerializer
        options:
            encoding: binary
            format: compact
    eventsink:
        class: EventLogger
        options:
            target event: ripple
    datasink_ev:
        class: FileSerializer
        options:
            encoding: yaml
            format: full
    datasink_ripplestats:
        class: FileSerializer
        options:
            encoding: binary
            format: compact
    stimulation_trigger:
        class: EventDelayed
        options:
            detection only mode: false
            delayed mode: false # switch for true if you want delayed events
            event trigger lockout time:     # Stop the trigger of events but still are counted in the statistics of the ripple detector
               period:  250
               detection: false
               stimulation: true
   
            analysis lockout time: # Stop the detection in the ripple detector after a stimulation
               period: 50
               starting time: [0]

            delayed range: [150, 200]
    ttl_output:
        class: SerialOutput

connections:
    - source.hp=ripple_filter1.data
    - source.cx=ripple_filter2.data
    - ripple_filter1.data=HIPPOCAMPUS_detector.data
    - ripple_filter2.data=CORTEX_detector.data
    - HIPPOCAMPUS_detector.events=eventfilter.events
    - HIPPOCAMPUS_detector.events=eventsink.events
    - eventfilter.events=datasink_ev.data
    - stimulation_trigger.events=networksink.data
    - HIPPOCAMPUS_detector.statistics=datasink_ripplestats.data
    - HIPPOCAMPUS_detector.statistics=networksink.data
    - CORTEX_detector.statistics=networksink.data
    - CORTEX_detector.events=eventfilter.blocking_events
    - eventfilter.events=stimulation_trigger.events
    - stimulation_trigger.events=ttl_output.events

states:
    - [stimulation_trigger.analysis enabled, HIPPOCAMPUS_detector.detection enabled]
